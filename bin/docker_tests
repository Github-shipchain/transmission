#!/bin/bash

set -e

# magic line to ensure that we're always inside the root of our application,
# no matter from which directory we'll run script
# thanks to it we can just enter `./bin/docker_tests`
cd "${0%/*}/.."

echo "Running tests"

find -name "*.pyc" -delete

bin/dc build

bin/dc up -d

bin/dc exec -T runserver prospector -o pylint

bin/dc exec -T runserver pytest -p no:cacheprovider --cov=apps --cov-config=.coveragerc

bin/dc down
